name: Download Button Action ðŸŽƒ

on:
  workflow_dispatch:
  release:
    types:
      - published

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Get Latest Release
        id: get-latest-release
        uses: InsonusK/get-latest-release@v1.0.1
        with:
          myToken: ${{ github.token }}
          view_top: 1

      - name: Update Halloween Download Button
        env:
          GITHUB_USER: "KingIcyCream1"
          REPO: "Multi-Roblox"
          FORMAT: "zip"
          VERSION: "${{ steps.get-latest-release.outputs.tag_name }}"
          COLOR_LEFT: "FF6B00"
          COLOR_RIGHT: "6B1B6F"
          BEGIN_TAG: "<!-- sDOWNLOAD -->"
          END_TAG: "<!-- eDOWNLOAD -->"
        run: |
          DOWNLOAD=$(curl -s "https://api.github.com/repos/${{ env.GITHUB_USER }}/${{ env.REPO }}/releases/latest" | jq -r '.assets[0].browser_download_url')
          UPDATED=$(perl -0777 -pe "s#(${{ env.BEGIN_TAG }})(?:.|\n)*?(${{ env.END_TAG }})#\1\n[![ðŸŽƒ Download Halloween Edition](https://img.shields.io/badge/Download_Halloween_Edition-${{ env.COLOR_LEFT }}%20to%20${{ env.COLOR_RIGHT }}?style=for-the-badge&logo=ghost&logoColor=white&labelColor=1A1A1A)]($DOWNLOAD)\n\2#g" README.md)
          echo "$UPDATED" > README.md

      - uses: EndBug/add-and-commit@v9
        with:
          message: "ðŸŽƒ Update Halloween download button to ${{ steps.get-latest-release.outputs.tag_name }}"
          default_author: github_actions
          branch: master
